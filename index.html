<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Talk</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="icon" type="image/x-icon" href="/public/icon.png">
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <!-- Barra de NavegaciÃ³n Superior -->
    <nav class="Navbar bg-gray-900 shadow-lg fixed top-0 left-0 right-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="flex items-center justify-between h-16">
                <div class="flex items-center gap-3">
                    <img class="logo" src="/public/logo.png" alt="ChatRooms Logo" class="w-10 h-10">
                </div>
                <div class="flex items-center gap-4">
                    <input type="text" placeholder="Buscar..." class="px-4 py-2 bg-gray-800 text-white rounded-full w-64 focus:outline-none focus:ring-2 focus:ring-purple-500">
                    
                    <!-- Botones para usuarios NO logueados -->
                    <div id="guestButtons" class="flex items-center gap-3">
                        <a href="/pages/login.html" class="px-6 py-2 bg-transparent border-2 border-[#e84dbf] text-[#e84dbf] font-semibold rounded-full hover:bg-[#e84dbf] hover:text-white transition">
                            Iniciar SesiÃ³n
                        </a>
                        <a href="/pages/registro.html" class="px-6 py-2 bg-[#e84dbf] text-white font-semibold rounded-full hover:shadow-lg transition">
                            Registrarse
                        </a>
                    </div>

                    <!-- Botones para usuarios logueados -->
                    <div id="userButtons" class="hidden flex items-center gap-4">
                        <span id="userDisplay" class="text-white font-semibold"></span>
                        <button onclick="logout()" class="px-6 py-2 bg-red-500 text-white font-semibold rounded-full hover:bg-red-600 transition">
                            Cerrar SesiÃ³n
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </nav>
    <div class="max-w-7xl mx-auto px-4 pt-20 pb-8">
        <div class="flex gap-6">
            <aside class="w-80 flex-shrink-0">
                <div class="bg-gray-900 rounded-2xl shadow-xl p-5 sticky top-24">
                    <h2 class="text-xl font-bold text-white mb-4 flex items-center gap-2">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                        </svg>
                        Salas de Chat
                    </h2>
                    <div class="gradient-bar mb-4"></div>
                    
                    <div id="roomsList" class="space-y-2">
                        <!-- Las salas se cargarÃ¡n dinÃ¡micamente -->
                    </div>

                    <button onclick="handleCreateRoom()" class="w-full mt-4 py-2 bg-[#cc2d9e] text-white font-semibold rounded-full hover:shadow-lg transition">
                        + Crear Sala
                    </button>
                </div>
            </aside>

            <!-- Feed Central - Publicaciones -->
            <main class="flex-1">
                <!-- Crear PublicaciÃ³n -->
                <div class="bg-gray-900 rounded-2xl shadow-xl p-5 mb-6">
                    <div class="flex gap-3">
                        <div class="w-12 h-12 bg-gradient-to-br from-purple-500 to-pink-500 rounded-full flex items-center justify-center text-white font-bold">
                            <span id="userAvatar">?</span>
                        </div>
                        <input type="text" id="postInput" placeholder="Â¿QuÃ© estÃ¡s pensando?" class="flex-1 px-4 py-3 bg-gray-800 text-white rounded-full focus:outline-none focus:ring-2 focus:ring-purple-500 cursor-pointer" onclick="handleCreatePost()">
                    </div>
                </div>

                <!-- Publicaciones -->
                <div id="postsContainer" class="space-y-4">
                    <!-- Post 1 -->
                    <article class="post-card bg-gray-900 rounded-2xl shadow-xl p-6">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-blue-500 to-cyan-500 rounded-full flex items-center justify-center text-white font-bold">
                                M
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2">
                                    <h3 class="text-white font-bold">MarÃ­a LÃ³pez</h3>
                                    <span class="text-gray-400 text-sm">â€¢ hace 2 horas</span>
                                </div>
                                <p class="text-purple-400 text-sm">en Cine & Series</p>
                            </div>
                        </div>
                        <p class="text-white text-lg mb-4">Acabo de terminar de ver la Ãºltima temporada de Stranger Things y WOW... ese final me dejÃ³ sin palabras ðŸ˜± Â¿Alguien mÃ¡s ya la vio?</p>
                        <div class="flex items-center gap-6 text-gray-400">
                            <button class="flex items-center gap-2 hover:text-purple-400 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path>
                                </svg>
                                <span>124</span>
                            </button>
                            <button class="flex items-center gap-2 hover:text-purple-400 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                <span>45</span>
                            </button>
                            <button class="flex items-center gap-2 hover:text-purple-400 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                                </svg>
                            </button>
                        </div>
                    </article>

                    <!-- Post 2 -->
                    <article class="post-card bg-gray-900 rounded-2xl shadow-xl p-6">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-green-500 to-emerald-500 rounded-full flex items-center justify-center text-white font-bold">
                                J
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2">
                                    <h3 class="text-white font-bold">Juan PÃ©rez</h3>
                                    <span class="text-gray-400 text-sm">â€¢ hace 5 horas</span>
                                </div>
                                <p class="text-purple-400 text-sm">en Estudiantes</p>
                            </div>
                        </div>
                        <p class="text-white text-lg mb-4">Â¿Alguien tiene tips para estudiar para finales? Estoy sÃºper estresado y no sÃ© por dÃ³nde empezar ðŸ“šðŸ˜…</p>
                        <div class="flex items-center gap-6 text-gray-400">
                            <button class="flex items-center gap-2 hover:text-purple-400 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path>
                                </svg>
                                <span>87</span>
                            </button>
                            <button class="flex items-center gap-2 hover:text-purple-400 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                <span>32</span>
                            </button>
                            <button class="flex items-center gap-2 hover:text-purple-400 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                                </svg>
                            </button>
                        </div>
                    </article>

                    <!-- Post 3 -->
                    <article class="post-card bg-gray-900 rounded-2xl shadow-xl p-6">
                        <div class="flex items-start gap-3 mb-4">
                            <div class="w-12 h-12 bg-gradient-to-br from-pink-500 to-rose-500 rounded-full flex items-center justify-center text-white font-bold">
                                A
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center gap-2">
                                    <h3 class="text-white font-bold">Ana GarcÃ­a</h3>
                                    <span class="text-gray-400 text-sm">â€¢ hace 1 dÃ­a</span>
                                </div>
                                <p class="text-purple-400 text-sm">en Arte & DiseÃ±o</p>
                            </div>
                        </div>
                        <p class="text-white text-lg mb-4">TerminÃ© mi primer proyecto de ilustraciÃ³n digital! ðŸŽ¨âœ¨ Me tomÃ³ semanas pero estoy super orgullosa del resultado</p>
                        <div class="flex items-center gap-6 text-gray-400">
                            <button class="flex items-center gap-2 hover:text-purple-400 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"></path>
                                </svg>
                                <span>256</span>
                            </button>
                            <button class="flex items-center gap-2 hover:text-purple-400 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"></path>
                                </svg>
                                <span>68</span>
                            </button>
                            <button class="flex items-center gap-2 hover:text-purple-400 transition">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8.684 13.342C8.886 12.938 9 12.482 9 12c0-.482-.114-.938-.316-1.342m0 2.684a3 3 0 110-2.684m0 2.684l6.632 3.316m-6.632-6l6.632-3.316m0 0a3 3 0 105.367-2.684 3 3 0 00-5.367 2.684zm0 9.316a3 3 0 105.368 2.684 3 3 0 00-5.368-2.684z"></path>
                                </svg>
                            </button>
                        </div>
                    </article>
                </div>
            </main>
        </div>
    </div>

    <script>
        const API_URL = 'http://localhost:8000';
        let currentUser = null;

        // Verificar autenticaciÃ³n al cargar la pÃ¡gina
        async function checkAuth() {
            const token = localStorage.getItem('token');
            const username = localStorage.getItem('username');

            if (token && username) {
                try {
                    const response = await fetch(`${API_URL}/users/me`, {
                        headers: {
                            'Authorization': `Bearer ${token}`
                        }
                    });

                    if (response.ok) {
                        currentUser = await response.json();
                        showUserInterface();
                    } else {
                        showGuestInterface();
                    }
                } catch (error) {
                    console.error('Error verificando autenticaciÃ³n:', error);
                    showGuestInterface();
                }
            } else {
                showGuestInterface();
            }
        }

        function showUserInterface() {
            document.getElementById('guestButtons').classList.add('hidden');
            document.getElementById('userButtons').classList.remove('hidden');
            document.getElementById('userDisplay').textContent = `@${currentUser.username}`;
            document.getElementById('userAvatar').textContent = currentUser.username.charAt(0).toUpperCase();
            document.getElementById('postInput').placeholder = 'Â¿QuÃ© estÃ¡s pensando?';
        }

        function showGuestInterface() {
            document.getElementById('guestButtons').classList.remove('hidden');
            document.getElementById('userButtons').classList.add('hidden');
            document.getElementById('userAvatar').textContent = '?';
            document.getElementById('postInput').placeholder = 'Inicia sesiÃ³n para publicar';
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('username');
            currentUser = null;
            showGuestInterface();
            location.reload();
        }

        function handleCreatePost() {
            if (!currentUser) {
                alert('Debes iniciar sesiÃ³n para publicar');
                window.location.href = 'login.html';
            } else {
                // AquÃ­ puedes abrir un modal o redirigir a una pÃ¡gina de creaciÃ³n de post
                const content = prompt('Â¿QuÃ© quieres publicar?');
                if (content) {
                    createPost(content, 1); // Por defecto en la sala 1
                }
            }
        }

        async function createPost(content, roomId) {
            const token = localStorage.getItem('token');
            try {
                const response = await fetch(`${API_URL}/posts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ content, room_id: roomId })
                });

                if (response.ok) {
                    alert('PublicaciÃ³n creada exitosamente');
                    loadPosts();
                } else {
                    alert('Error al crear la publicaciÃ³n');
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Error de conexiÃ³n');
            }
        }

        function handleCreateRoom() {
            if (!currentUser) {
                alert('Debes iniciar sesiÃ³n para crear una sala');
                window.location.href = '/pages/login.html';
            } else {
                alert('Funcionalidad de crear sala prÃ³ximamente');
            }
        }

        // Cargar salas de chat
        async function loadRooms() {
            try {
                const response = await fetch(`${API_URL}/rooms`);
                const rooms = await response.json();
                
                const roomsList = document.getElementById('roomsList');
                roomsList.innerHTML = rooms.map(room => `
                    <div class="chat-item p-3 rounded-xl cursor-pointer" onclick="handleRoomClick(${room.id})">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center gap-3">
                                <span class="text-2xl">${room.emoji}</span>
                                <div>
                                    <p class="text-white font-semibold">${room.name}</p>
                                    <p class="text-gray-400 text-sm">${room.members} miembros</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error cargando salas:', error);
            }
        }

        function handleRoomClick(roomId) {
            if (!currentUser) {
                alert('Inicia sesiÃ³n para unirte a esta sala');
                window.location.href = '/pages/login.html';
            } else {
                window.location.href = `chat-room.html?room=${roomId}`;
            }
        }

        // Cargar publicaciones
        async function loadPosts() {
            try {
                const response = await fetch(`${API_URL}/posts`);
                if (response.ok) {
                    const posts = await response.json();
                    // AquÃ­ puedes actualizar el feed con las publicaciones reales
                    console.log('Publicaciones cargadas:', posts);
                }
            } catch (error) {
                console.error('Error cargando publicaciones:', error);
            }
        }

        // Inicializar
        document.addEventListener('DOMContentLoaded', () => {
            checkAuth();
            loadRooms();
            loadPosts();
        });
    </script>
</body>
</html>